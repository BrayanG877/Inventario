import json
from datetime import datetime

# Cargar el inventario desde un archivo JSON
def Cargar_inventario():
    try:
        with open("inventario.json", "r") as archivo:
            return json.load(archivo)
    except FileNotFoundError:
        print("El archivo 'inventario.json' no existe. Creando inventario vacío...")
        return {}

# Guardar el inventario a un archivo JSON
def Guardar_inventario(inventario):
    with open("inventario.json", "w") as archivo:
        json.dump(inventario, archivo, indent=4)
    print("Inventario guardado correctamente.")

# Registrar un nuevo producto en el inventario
def Registrar_producto(inventario, Codigo_producto, Nombre_producto, Proveedor_producto):
    if Nombre_producto in inventario:
        print(f"El producto '{Nombre_producto}' ya está registrado.")
    else:
        inventario[Nombre_producto] = {
            "Codigo": Codigo_producto,
            "Proveedor": Proveedor_producto,
            "BODEGAS": {"Norte": 0, "Centro": 0, "Oriente": 0},
            "Historial": []
        }
        print(f"Producto '{Nombre_producto}' ha sido registrado correctamente.")

# Ingresar productos a una bodega
def Ingresar_producto(inventario, Nombre_producto, Cantidad, Bodega):
    if Nombre_producto in inventario:
        if Bodega in inventario[Nombre_producto]["BODEGAS"]:
            inventario[Nombre_producto]["BODEGAS"][Bodega] += Cantidad
            Fecha_hora = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            operacion = {
                "Tipo": "Entrada",
                "Cantidad": Cantidad,
                "Bodega": Bodega,
                "Fecha": Fecha_hora,
                "Descripcion": "Ingreso al inventario"
            }
            inventario[Nombre_producto]['Historial'].append(operacion)
            print(f"Se han ingresado {Cantidad} unidades de '{Nombre_producto}' en la bodega '{Bodega}'.")
        else:
            print(f"La bodega '{Bodega}' no es válida. Las bodegas disponibles son: Norte, Centro, Oriente.")
    else:
        print(f"El producto '{Nombre_producto}' no está registrado en el inventario.")

# Retirar productos de una bodega
def Retirar_producto(inventario, Nombre_producto, Cantidad, Bodega, Descripcion):
    if Nombre_producto in inventario:
        if Bodega in inventario[Nombre_producto]["BODEGAS"]:
            if inventario[Nombre_producto]["BODEGAS"][Bodega] >= Cantidad:
                inventario[Nombre_producto]["BODEGAS"][Bodega] -= Cantidad
                Fecha_hora = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                operacion = {
                    "Tipo": "Salida",
                    "Cantidad": Cantidad,
                    "Bodega": Bodega,
                    "Fecha": Fecha_hora,
                    "Descripcion": Descripcion
                }
                inventario[Nombre_producto]['Historial'].append(operacion)
                print(f"Se han retirado {Cantidad} unidades de '{Nombre_producto}' en la bodega '{Bodega}'.")
            else:
                print(f"No hay suficiente stock en la bodega '{Bodega}' para retirar {Cantidad} unidades.")
        else:
            print(f"La bodega '{Bodega}' no es válida.")
    else:
        print(f"El producto '{Nombre_producto}' no está registrado en el inventario.")

# Buscar un producto por su nombre o código
def Buscar_producto(inventario, Nombre_producto):
    if Nombre_producto in inventario:
        datos = inventario[Nombre_producto]
        print(f"\nProducto: {Nombre_producto}")
        print(f"Código: {datos['Codigo']}")
        print(f"Proveedor: {datos['Proveedor']}")
        for Bodega, Cantidad in datos['BODEGAS'].items():
            print(f"Cantidad en Bodega {Bodega}: {Cantidad}")
    else:
        print(f"El producto '{Nombre_producto}' no está registrado.")

# Ver el historial de un producto
def Historial_producto(inventario, Nombre_producto):
    if Nombre_producto in inventario:
        datos = inventario[Nombre_producto]
        print(f"\nHistorial de '{Nombre_producto}':")
        for operacion in datos['Historial']:
            print(f"Fecha: {operacion['Fecha']}, Tipo: {operacion['Tipo']}, Cantidad: {operacion['Cantidad']}, Bodega: {operacion['Bodega']}, Descripción: {operacion['Descripcion']}")
    else:
        print(f"El producto '{Nombre_producto}' no está registrado.")

# Generar reporte de inventario
def Reporte(inventario):
    print("\nReporte de Inventario:")
    for producto, datos in inventario.items():
        total = sum(datos['BODEGAS'].values())
        print(f"Producto: {producto}")
        print(f"Código: {datos['Codigo']}")
        print(f"Proveedor: {datos['Proveedor']}")
        print(f"Cantidad total en inventario: {total}")
        for Bodega, Cantidad in datos['BODEGAS'].items():
            print(f"Cantidad en Bodega {Bodega}: {Cantidad}")
        print("-" * 30)
